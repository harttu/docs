Snakeoil - kotikutoinen varmenne
-----------

Create public and private key. 509 is name of a standard. -nodes, do not encrypt key.
```bash
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -sha256 -days 3650 -nodes
```
Makes 
- cert.pem - public
- key.pem - private, if -nodes, no encryption

# Examine public key
```bash
openssl x509 -in key.pem -noout -text | less
```

Julkinen sertifikaatti muotoa:
```
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            HEXaa
         Signature Algorithm: ESIM: sha256WithRSAEncryption
                Validity
                    Not Before: Jan 01 12:11:23 2023 GMT
                    Not After: ...
                   ...
           Subject Public Key Info:
 modulO: HEX (long)
 Exponent: int
 ```
 
 Enter the container
 ```bash
 docker exec -it docker-nginx-1 /bin/sh
 ```
 
 /etc/nginx/conf.d tiedosto:
```nginx
# HTTPS config.
server {
        # Set the port to listen to both in IPv4 and IPv6. Use SSL and HTTP/2.
        listen 443 ssl http2;     #http2?
        listen [::]:443 ssl http2; # [::] kaikki ipv6
        # Set the server address.
         #server_name peruna.maa.net; # tässä voitaisiin reitittää
		server_name _; # _ = alaviiva: millä tahansa nimellä pääsee tähän
        # Import self-signed certificates for testing purposes.
        # DO NOT use this in production, please.
        include snippets/snakeoil.conf; 
		
		# sisältö:
		#### Self signed certificates generated by the ssl-cert package
        #### Don't use them in a production server!
        ##ssl_certificate /etc/ssl/certs/ssl-cert-snakeoil.pem;
        ##ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;
     # sisältö loppuu
		
		# Proxy paths.
        # Root path.
        # Tämän avulla voidaan reitittää
        location / {
                return 404;
        }
        # Jotkut palvelut halua asua /jotain/ alla, 
        # tällä konfilla saadaan palvelu luulemaan ,että se on juuressa
        #  https://address/jotain/.
        location /jotain/ {
                rewrite ^/jotain/(.*)$ /$1 break; # rstudion mukaan ollaan koko ajan juuressa
                proxy_pass http://localhost:8787;  # kutsutaan palvelua
                proxy_redirect http://localhost:8787/ $scheme://$http_host/jotain/;  # korvaa takaisin /rstudio päätteen,kun lähetään takaisin
                proxy_http_version 1.1; 
                proxy_set_header Upgrade $http_upgrade; # Upgrade avulla voidaan mennä http (tilaton) - protokollasta websocket (tilallinen, kiinteä , ei keksejä) yms.
                proxy_set_header Connection "Upgrade";
        }
}
```
